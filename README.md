# simple-chat-2020

大学の卒業研究のために作成しました。
誰かが入力しているときに、入力していることを他の参加者がわかるようになっています。
"入力中"の表示方法については3種類あります(後述)


## 動作環境・要件

PostgreSQL/PHP/JavaScript/HTML/CSSを使用し、Heroku上で運用しました。
チャットで会話をするユーザーは、Webブラウザを使用して参加します。パソコンの他、スマートフォンやタブレット端末でも利用できます。


## 使い方

今回の卒業研究では、まずHerokuでPostgreSQLを利用できる状態にしてから、GitHubのプライベートリポジトリ経由でデプロイをしました。
`index.php`ファイルは、Heroku上でPHPを利用していることを認識させるために作成しましたが、こちらは適宜内容を変更しても問題ありません。
まず、このプロジェクト内のファイルをプライベートリポジトリに保存します。GitHubでは、ログインしなくてもブラウザでzipファイルをダウンロードできます。またGitHubはアップロードでファイルを登録することもできます。
次に、リポジトリの最も上の階層にある、`delete_typing.php`、`get_messages_all.php`、`get_typing.php`、`regist_post.php`、`regist_typing.php`、`setup_db_message.php`、`setup_db_typing.php`にホスト名やDB名、サーバーのユーザー名・パスワードを書き込みます。現在は`'****'`に置き換えてあります。現在は直接書き込むようになっていますが、別ファイルから参照するようにもできると思います。
次に、「入力中」の表示方法に応じて`_sample_typea.html`、`_sample_typeb.html`、`_sample_typec.html`を元にユーザーがアクセスするためのHTMLファイルを作成します。8行目の`room_id`の後の文字列にトークルームのIDを書き込み、またhtmlのtitle属性や19行目あたりのh2タグの部分もルーム名を書き換えます。
最後に、サーバーへファイルを転送(デプロイ)し、`setup_db_message.php`、`setup_db_typing.php`にアクセスし、それぞれ送信されたメッセージを保存するテーブルを作成、入力中の情報を保存するテーブルを作成します。URLの引数に`?room_id=ルームID`を指定します。入力中の情報を表示しない場合には、`setup_db_typing.php`でテーブルを作成しなくても問題ありません。
あとは、それぞれのトークルームごとのHTMLファイルのアドレスをブラウザに入力すればチャットができるはずです。
`admin.php`と`/js/admin.js/`は、管理画面ですが、現在制作中です。データベースの初期化や、送信されたメッセージの確認ができるようになる予定です。


## 「入力中」について

`_sample_typea.html`、`_sample_typeb.html`では11行目で指定しているJavaScriptファイルが異なります。
`typea.js`では、誰かが入力しているときに「〇〇 が入力しています」と表示されます。複数人が入力中の場合は「〇〇、〇〇 が入力しています」と表示されます。〇〇の部分は入力している人のユーザー名が入ります。
`typeb.js`では、誰かが入力しているときに、人数にかかわらず「入力している人がいます」と表示されます。ユーザー名やIDは表示されません。
`typea.js`、`typeb.js`のどちらも入力している人がいない場合には「誰も入力していません」と表示されます。
また35行目で指定している`typing_status.js`では、メッセージの入力欄をクリックしたり、文字を入力した時に「入力中」という情報をサーバーに送信します。また、入力欄からフォーカスが外れた(入力をやめた)時には、「入力中」情報を削除します。

`_sample_typec.html`では`typea.js`または`typeb.js`がないため、誰かが入力中でも「入力中」とは表示されません。また、「入力中」と表示する必要がないため`typing_status.js`も指定していません。


## 詳しい説明

[Qiita](https://qiita.com/ikebe094/private/80870b714fb36d0f4eeb)
